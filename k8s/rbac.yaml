apiVersion: v1
kind: ServiceAccount
metadata:
  name: network-monitor
  namespace: default
  labels:
    app: network-monitor
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: network-monitor-antrea
  labels:
    app: network-monitor
rules:
  # Antrea CRDs
  - apiGroups: ["crd.antrea.io"]
    resources: ["packetcaptures", "traceflows"]
    verbs: ["get", "list", "watch", "create", "delete"]
  - apiGroups: ["crd.antrea.io"]
    resources: ["packetcaptures/status", "traceflows/status"]
    verbs: ["get"]
  
  # Antrea system resources
  - apiGroups: ["system.antrea.io"]
    resources: ["supportbundles", "controllerinfos", "agentinfos"]
    verbs: ["get", "list"]
  
  # Core resources for pod info
  - apiGroups: [""]
    resources: ["pods", "namespaces", "nodes", "services"]
    verbs: ["get", "list", "watch"]
  
  # Network policies
  - apiGroups: ["networking.k8s.io"]
    resources: ["networkpolicies"]
    verbs: ["get", "list", "watch"]
  
  # Antrea network policies
  - apiGroups: ["crd.antrea.io"]
    resources: ["antreanetworkpolicies", "clusternetworkpolicies"]
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: network-monitor-antrea
  labels:
    app: network-monitor
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: network-monitor-antrea
subjects:
  - kind: ServiceAccount
    name: network-monitor
    namespace: default
